---
title: 博客施工记录
categories:
  - 环境搭建
# cover: 
reprint: false
date: 2022-01-18 17:37:53
tags:
---

记录一下hexo的施工过程。暂时使用hexo + github pages，hexo代码放在vps上，有时间可以研究一下github和vps的DNS负载均衡。

主要参考K大的这篇[基于 Hexo 的全自动博客构建部署系统 ](https://kchen.cc/2016/11/12/hexo-instructions/#什么是-Hexo)，我再稍微补充一些自己遇到的坑。

# 新建文章

在hexo根目录下，终端输入

`hexo new [layout] [title]`

| Layout         | Path           |
| -------------- | -------------- |
| post (default) | source/_posts  |
| draft          | source/_drafts |
| page           | source         |

草稿发布

`hexo publish [title]`

# md图床问题

Markdown使用图床很方便，我现在用的图床是SMMS，暂时没多大问题，但前期做好备份还是有备无患。因此，最好的解决方案是先将图片保存到本地目录，写完push至github后，结合Action自动读取md源文件，并将图片链接转换为图床链接，再完成hexo渲染。

# 编写自己的Action

[官方提供两种方式创建Action](https://docs.github.com/cn/actions/creating-actions/about-custom-actions)，一种是JS环境创建，一种是通过Docker容器创建。这里使用Docker容器创建。

# Github Action自动部署

每次部署在本地hexo g -d，只是在本地构建文件再提交，github只充当了一个静态服务器的作用，没有起到git的作用，因此使用Github Action可以实现自动化部署，且可以实现图床链接的替换。![test1](博客施工记录/waifu (1).png)

在`.github`目录下新建文件夹`.workflows`，再新建文件`deployment.yml`，代码如下：

```yaml
name: Hexo Auto-Deploy
on: [push]

jobs:
  build:
    name: Hexo Auto-Deploy
    runs-on: ubuntu-latest

    steps:
    - name: 1. git checkout...
      uses: actions/checkout@v2.4.0

    - name: 2. setup nodejs...
      uses: actions/setup-node@v2.5.1

    - name: 3. install hexo...
      run: |
        npm install hexo-cli -g
        npm install
        npm list --depth 0

    - name: 4. hexo generate
      run: |
        hexo clean
        hexo g


    - name: 5. hexo deploy ...
      run: |
        mkdir -p ~/.ssh/
        echo "${{ secrets.ACCESS_TOKEN }}" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
        ssh-keyscan github.com >> ~/.ssh/known_hosts

        git config --global user.name "zrtty1998"
        git config --global user.email "zrtty1998@gmail.com"
        git config --global core.quotepath false

        hexo d

```

![test2](博客施工记录/waifu (2).png)
